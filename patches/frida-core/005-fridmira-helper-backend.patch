From 3abe3c3844b474dc3cf16a555611b06de25b8246 Mon Sep 17 00:00:00 2001
From: imkenf <imkenf@gmail.com>
Date: Thu, 12 Jun 2025 18:42:34 +0800
Subject: [PATCH 5/6] FridMira: Add socket name obfuscation to Linux helper
 backend

---
 src/linux/frida-helper-backend.vala | 23 ++++++++++++++++++++++-
 1 file changed, 22 insertions(+), 1 deletion(-)

diff --git a/src/linux/frida-helper-backend.vala b/src/linux/frida-helper-backend.vala
index 1bbe475..38560d4 100644
--- a/src/linux/frida-helper-backend.vala
+++ b/src/linux/frida-helper-backend.vala
@@ -1252,7 +1252,28 @@ namespace Frida {
 		}
 
 		private static string make_fallback_address () {
-			return "/frida-" + Uuid.string_random ();
+			// FridMira Socket Name Obfuscation - Generate realistic library-like socket names
+			// FridMira Socket名混淆 - 生成逼真的库名样式socket名
+			string default_address = "/frida-" + Uuid.string_random ();
+			
+			// Apply FridMira library name obfuscation if available
+			// 应用FridMira库名混淆（如果可用）
+			string? global_mode = Environment.get_variable("FRIDMIRA_MODE");
+			string? file_mode = Environment.get_variable("FRIDMIRA_FILE_MODE");
+			bool should_obfuscate = (file_mode != null && file_mode.down() == "enabled") ||
+			                       (file_mode == null && global_mode != null && global_mode.down() == "enabled");
+			
+			if (should_obfuscate) {
+				try {
+					return "/" + FridMira.FridMiraLibNameGenerator.generate_lib_name();
+				} catch (Error e) {
+					// Fallback to original naming if FridMira fails
+					// 如果FridMira失败则回退到原始命名
+					return default_address;
+				}
+			}
+			
+			return default_address;
 		}
 
 		private Future<RemoteAgent> establish_connection (LoaderLaunch launch, InjectSpec spec, BootstrapResult bres,
-- 
2.45.1.windows.1

