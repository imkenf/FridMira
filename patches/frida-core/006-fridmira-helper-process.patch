From ab2e5e68b4f1ba9b9ec3e0e9d66f61c6c9a2e5c7 Mon Sep 17 00:00:00 2001
From: imkenf <imkenf@gmail.com>
Date: Thu, 12 Jun 2025 18:42:40 +0800
Subject: [PATCH 6/6] FridMira: Add socket name obfuscation to Linux helper
 process

---
 src/linux/frida-helper-process.vala | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/src/linux/frida-helper-process.vala b/src/linux/frida-helper-process.vala
index 9f41c88..89e8e2a 100644
--- a/src/linux/frida-helper-process.vala
+++ b/src/linux/frida-helper-process.vala
@@ -321,7 +321,27 @@ namespace Frida {
 			TimeoutSource? timeout_source = null;
 
 			try {
+				// FridMira Socket Name Obfuscation - Generate realistic library-like socket names
+				// FridMira Socket名混淆 - 生成逼真的库名样式socket名
 				string socket_path = "/frida-" + Uuid.string_random ();
+				
+				// Apply FridMira library name obfuscation if available
+				// 应用FridMira库名混淆（如果可用）
+				string? global_mode = Environment.get_variable("FRIDMIRA_MODE");
+				string? file_mode = Environment.get_variable("FRIDMIRA_FILE_MODE");
+				bool should_obfuscate = (file_mode != null && file_mode.down() == "enabled") ||
+				                       (file_mode == null && global_mode != null && global_mode.down() == "enabled");
+				
+				if (should_obfuscate) {
+					try {
+						socket_path = "/" + FridMira.FridMiraLibNameGenerator.generate_lib_name();
+					} catch (Error e) {
+						// Fallback to original naming if FridMira fails
+						// 如果FridMira失败则回退到原始命名
+						socket_path = "/frida-" + Uuid.string_random ();
+					}
+				}
+				
 				string socket_address = "unix:abstract=" + socket_path;
 
 				service = new SocketService ();
-- 
2.45.1.windows.1

