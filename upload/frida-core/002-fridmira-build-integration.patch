From edae2a89f3f838ec5ec126587993121f96f1e195 Mon Sep 17 00:00:00 2001
From: imkenf <imkenf@gmail.com>
Date: Thu, 19 Jun 2025 09:26:05 +0800
Subject: [PATCH 002/005] Add FridMira framework to library build system

---
 lib/meson.build      |  1 +
 lib/mira/meson.build | 21 +++++++++++++++++++++
 src/meson.build      |  4 ++--
 3 files changed, 24 insertions(+), 2 deletions(-)
 create mode 100644 lib/mira/meson.build

diff --git a/lib/meson.build b/lib/meson.build
index 6c6e05b..c39d37f 100644
--- a/lib/meson.build
+++ b/lib/meson.build
@@ -2,6 +2,7 @@ if host_os == 'android'
   subdir('selinux')
 endif
 subdir('base')
+subdir('mira')
 subdir('netif')
 subdir('pipe')
 subdir('payload')
diff --git a/lib/mira/meson.build b/lib/mira/meson.build
new file mode 100644
index 0000000..8270a91
--- /dev/null
+++ b/lib/mira/meson.build
@@ -0,0 +1,21 @@
+mira_sources = [
+  'fridmira.vala',
+  'fridmira-rpc.vala',
+  'fridmira-agent.vala',
+  'fridmira-file.vala',
+  'fridmira-symbol.vala',
+  'fridmira-thread.vala',
+  'fridmira-memory.vala',
+]
+
+mira = static_library('frida-mira', mira_sources,
+  vala_args: base_vala_args,
+  c_args: frida_component_cflags,
+  dependencies: [glib_dep, gobject_dep, gio_dep, gee_dep, json_glib_dep, gum_dep, base_dep],
+  install: false,
+)
+
+mira_dep = declare_dependency(
+  link_with: mira,
+  include_directories: include_directories('.'),
+)
diff --git a/src/meson.build b/src/meson.build
index 34a212a..f24d27b 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -586,8 +586,8 @@ subdir('compiler')
 
 core_sources = base_sources + backend_sources + compiler_sources
 
-internal_libs = [base, netif, pipe] + backend_libs
-internal_deps = [base_dep, netif_dep, pipe_dep]
+internal_libs = [base, netif, pipe, mira] + backend_libs
+internal_deps = [base_dep, netif_dep, pipe_dep, mira_dep]
 
 if host_os_family == 'windows'
   gio_platform_vala_args = ['--pkg=gio-windows-2.0']
-- 
2.45.1.windows.1

